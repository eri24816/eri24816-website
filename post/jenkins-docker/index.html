<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Continuously Deploy a Docker Application with Jenkins | Chen, Ping-Yi</title><link rel=stylesheet href=/css/main.css><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin=anonymous referrerpolicy=no-referrer></head><body><header><nav><div class=float-left><a href=/>Chen, Ping-Yi</a></div><div class=float-right><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a></div></nav><style>nav{padding:0 10px;display:flex;justify-content:space-between}nav .float-left{display:flex;list-style:none;gap:1rem;margin:0;padding:0}nav .float-right{display:flex;list-style:none;gap:1rem;margin:0;padding:0}nav a{padding:.5rem;transition:color .2s}nav a:hover{color:#fff}</style></header><main><div class=post><a href=/>Home > </a><a href=/categories/tech>Tech ></a><h1>Continuously Deploy a Docker Application with Jenkins</h1><time datetime=2024-11-18T00:00:00+00:00>November 18, 2024</time>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]},loader:{load:["ui/safe"]}}</script><p>I created an AI-generated music application using Vue and Python, and I used Jenkins to automatically pull each commit from GitHub and deploy it to the server. It&rsquo;s very convenient!</p><p>The initial setup involves installing Docker and Jenkins on the server. However, someone helped me with the installation, so I won’t go into the details here. (I don’t know how to install them either.)</p><h1 id=add-jenkinsfile-and-dockerfile>Add Jenkinsfile and Dockerfile</h1><p>First, add Jenkinsfile and Dockerfile to your git repo.</p><p>The Jenkinsfile is used to define three tasks to perform whenever there’s a new commit: build the image, remove the old container, then run the new container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>pipeline</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>agent</span> <span style=color:#a6e22e>any</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stages</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stage</span>(<span style=color:#e6db74>&#39;Build&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>steps</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>script</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>sh</span> <span style=color:#e6db74>&#39;docker build -t midi-gen .&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stage</span>(<span style=color:#e6db74>&#39;Run&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>steps</span> { 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>script</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>sh</span> <span style=color:#e6db74>&#39;docker ps -qa --filter &#34;name=midi-gen&#34; | grep -q . &amp;&amp; docker stop midi-gen &amp;&amp; docker rm midi-gen || true&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>sh</span> <span style=color:#e6db74>&#39;docker run --name midi-gen -e CHECKPOINT_PATH=/volume/checkpoint.pt -v /home/eri/midi-gen-volume:/volume -p 8010:8010 --gpus all --rm -d midi-gen&#39;</span> 
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The content of the Dockerfile is not the focus of this discussion and may not always look like this, but I put it here FYI anyway:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:22-alpine as frontend-builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /frontend</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> frontend/package.json frontend/package-lock.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> frontend/ .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build-only<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> pytorch/pytorch:2.5.1-cuda12.4-cudnn9-runtime</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app/backend</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get upgrade -y <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y git<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> backend/pyproject.toml .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip install -e .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> backend/ .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>frontend-builder /frontend/dist ./static<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;uvicorn&#34;</span>, <span style=color:#e6db74>&#34;backend.app.main:app&#34;</span>, <span style=color:#e6db74>&#34;--host&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#e6db74>&#34;--port&#34;</span>, <span style=color:#e6db74>&#34;8010&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h1 id=set-up-the-pipeline-on-jenkins>Set up the pipeline on Jenkins</h1><p>First, install the GitHub plugin in Jenkins.</p><p>Then, create a new pipeline.</p><p><img src=https://i.imgur.com/oSjajxr.png alt>
<img src=https://i.imgur.com/zt6vmdb.png alt></p><p>Enter pipeline configuration, and specify the git repo and the build trigger
<img src=https://i.imgur.com/nKd12Lb.png alt>
<img src=https://i.imgur.com/lvVA2t3.png alt></p><p>Finally, add a webhook to your GitHub repository, pointing to <code>&lt;your jenkins url>/github-webhook/</code>. This way, GitHub will notify Jenkins to deploy whenever you push changes.
<img src=https://i.imgur.com/x8EonGV.png alt></p><p>And that’s it! The automatic deployment setup is complete. You can try making a commit to test it—Jenkins should trigger the pipeline and start/update your application on the server.</p><div><div>Tags:</div><ul><li><a href=/tags/tech/>Tech</a></li><li><a href=/tags/cicd/>CICD</a></li><li><a href=/tags/docker/>Docker</a></li><li><a href=/tags/jenkins/>Jenkins</a></li><li><a href=/tags/automation/>Automation</a></li></ul></div></div></main><footer><p>Copyright 2025 Ping-Yi Chen.</p></footer></body></html>